---
layout: post
title: (서버/일상) 입사 후 첫 번째 사고친 사람
description: 테스트
header: (서버/일상) 입사 후 첫 번째 사고친 사람
duration: 12 minutes read
ogimage: "img/favicon.png"
published: true
date: 2024-05-12
---

### 오늘의 음악 이야기

오늘의 추천 음악은 에스파의 슈퍼노바입니다. 라고 하고싶지만 이미 히트를 쳤기 때문에 넘어가봅니다.
확실히 한국 음악의 트렌드세터들은 전부 아이돌 시장으로 몰리는 느낌입니다.

### 시작하기 앞서 

안녕하세요 원래는 '리스크 관리'에 관해서 쓰려고 했는데 요즘 드는 생각이 저의 생각은 남이 봤을 때 객관적으로 받아들이기 
힘들겠다는 생각이 듭니다. 예를들면 그림, 음악, 스포츠 경기 같이 누구에게나 다름없이 객관적으로 보여지는 것들만
블로그에 적는게 낫겠다는 생각입니다. 그에따른 해석이나 주관적인 판단은 독자에게 맡기는 식으로 블로그를 운영하려 합니다.
정치, 경제 이런건 저도 잘 모르지만 같은 내용이어도 누구에게나 객관적으로 보여지진 않는다는 생각입니다. 
그래서 저의 생각 또한 다를게 없다고 생각합니다. 저 스스로 깎아둔 루틴이나 디테일도 저에게 맞춘거라
남들이 봤을 때 그냥 주관적인 개인의견일 뿐이라는 생각입니다. 그래서 앞으로는 최대한 객관적인 내용만 블로그에 추가하려 합니다.
특히 의학쪽은 객관적인 사실이라고 할지라도 적지 않겠습니다.

---

### 첫 번째 사고

사실 수습이 바로바로 돼서 큰 사고는 아니지만 벌써 사고를 쳤습니다. 회사 메일에서 지메일로 메일이 보내지지 않는 현상을 해결하는
업무를 받았는데 지메일로 한번 메일을 보내보니 PTR record setup 이라는 것을 설정하라고 AI 답장이 왔습니다.
그래서 PTR 설정이 뭔지 어떻게 설정하는지 하다가 본의아니게 메일서버를 다루게 되었습니다.
그래서 정방향조회, 역방향조회, zone, A, PTR 등에 대해 공부하게되었고 PTR 설정이 제대로 된건지 다시 한 번 체크하는 과정을 겪었습니다.
서론이 길었는데 아무튼 PTR 설정도 잘 되어있는데 왜 안되는지 모르겠어서 DNS 질의를 날리기 위한 포트인 53번 포트가 열리지 않았나?
싶은 마음에 iptables에 53번 포트를 열어봤습니다.
그래도 안되길래 다시 iptables를 초기화 한다는게 하필 본 블로그에서 iptables -F 였나를 하면 지울 수 있다길래
그 말을 믿고 명령어를 보냈더니 갑자기 메일 서버가 내려갔습니다.

처음에는 재부팅 되는 줄 알고 5분 가량 기다렸는데 5분이 다되어가도 열릴기미가 안보여서 바로 팀장님께 보고 했습니다.
reboot 명령어도 아니고 방화벽 관련 명령어에 서버가 내려갈거라고는 생각도 하지 못했네요 그래서 팀장님과 서버실로 갔는데
서버실에 서버만 있는게 아니고 노트북이 숨어있었습니다. 그 노트북이 루트 컴퓨터인데 그 노트북으로 서버를 살려야 합니다.
이 때부터는 거의 멘붕상태였는데 저만의 위기관리 매뉴얼이 있어서 그 매뉴얼대로 침착하게 대처한 결과 바로 서버를 살릴 수 있었습니다.
한 번에 해결해서 정말 운이 좋았습니다. 그 상황은 정말 지금 생각해도 아찔하네요 아무튼 당장 필요한 포트만 열어놓고 자리에 와서 다시 다른 포트들을 열었습니다.
ufw, iptables 이 무시무시한 방화벽 설정이 어떻게 연계되고 설정이 어떻게 진행되는지 위기의 순간에 닥치니까 빠르게 이해할 수 있었습니다.

이렇게 운영중인 메일 서버를 내려버리는 첫 번째 사고를 치고 그 뒤에 PTR 설정에 대해 다시 공부했습니다. 분명 로컬 DNS 질의에서는 PTR 응답이 정상적으로 오는데
저희 자체 DNS 서버인 Authentication Server 질의는 응답이 오지 않는 이상한 상황이었습니다. 
그래서 DNS에 대해 정확하게 공부하지 않으면 이 문제를 해결할 수 없다는 생각이 들어서 빠르게 공부한 끝에 AWS 홈페이지 에서 답을 찾을 수 있었습니다.
ISP 에서 IP를 빌려서 그 IP로 DNS 서버를 자체 구축한 상황에서는 PTR 설정을 ISP 업체에 직접 요청해야 한다는 것입니다.
Whois에 메일서버 아이피를 역으로 쳤을 때 ISP 업체 소유로 나온다면 요청하셔야 합니다. 
그외에 SPF, DKIM 설정이 제대로 되어 있는지도 확인해 주세요

이렇게 저는 단 3일만에 회사의 DNS 서버가 어떻게 구성되었는지부터 zone 설정, 네임서버, 메일서버 구성 등 전부 따라가면서 원인을 파악했습니다.
단순히 지메일에 메일이 안보내지는 이슈였을 뿐인데 어쩌다보니 
dns 동작원리, uwf, iptables 체인 설정, INPUT, OUTPUT, dport, sport, 포트별 역할, dig 동작원리 등 단기간에 빠삭해졌네요

---

### 회복하는 1년

요즘 점심 먹고 못해도 10분 정도 산책을 하는데 평생 갈 줄 알았던 불면증이 사라졌습니다. 혈당스파이크도 줄여줘서 점심먹고 졸리지 않는건 덤입니다. 
회사의 장점이라고 생각하는게 한강 산책로까지 5분도 안걸리기 때문에 인프라가 참 좋다는 생각입니다.
집 근처 산책은 서서울공원으로 가는데 여기는 천하제일갱쥐대회 입니다. 산책로도 잘돼있고 모든 종류의 강아지들을 볼 수 있어서 좋습니다.
그리고 올 해는 자체 회복 기간 느낌으로 그동안 잘못된 생활습관으로 생긴 안좋은 것들을 다 고치는데 집중하려 합니다.
특히 2.0이었던 시력이 10년만에 3M 앞 물체도 구분 못 할 정도로 너무 안좋아졌고 산책 하면서 안보이지만 멀리있는 것들을 보려고 하고 
허리도 아프고 거북목이 심해서 바른 자세를 유지하려고 합니다 유튜브 보고 스트레칭도 따라하면서 유연성까지 챙기고 있습니다.
배달음식도 줄일겸 7년만에 요리도 다시 시작했습니다. 
7년 전엔 승우아빠님이 스승님이었는데 지금은 류수영님 레시피로 하고 있습니다. 따라만해도 사먹는 것보다 맛있고 너무 편하네요.
암튼 1년 동안 열심히 회복해보겠습니다.

